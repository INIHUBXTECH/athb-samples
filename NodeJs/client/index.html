<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="ScreenOrientation" content="autoRotate:disabled">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이니허브 통합인증창 샘플</title>
</head>
<body>
<form id="form" name="form" action="success.jsp" method="post">
    <input type="hidden" id="authToken" name="authToken">
</form>
<div>
    <h3>이니허브 통합인증창 샘플</h3>
    <div>
        <input type="button" value="초기화" onclick="init()">
        <input type="button" value="인증" onclick="auth()">
    </div>
</div>

<script src="https://pol-stg.inihub.biz/lib/jquery-1.12.4.js"></script>
<script src="https://pol-stg.inihub.biz/inihub.js?dt=20230810"></script>
<script>

    // 이니허브 통합인증창 상태 코드
    let state = 0;

    /*
     * 이니허브 통합인증창 초기화
     */
    function init() {

        IHUB_C.init({
            baseUrl : 'https://pol-stg.inihub.biz',
            confName: '/conf/inihubEnvConfAWSSamgaDoc.json', //inihubEnvConf.json
            clientId: 'd9ce7cae-72df-466f-8462-17b3af57cf81',
            appKey  : 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhY2Nlc3NUb2tlbiIsInNjb3BlIjoiQVBQX0tFWSIsImlzcyI6Imh0dHBzOlwvXC9hdXRoLmluaWh1Yi5iaXoiLCJleHAiOjIwMDY5MTY2NDcsImp0aSI6IjJYSUpCOW1jU0hzX0VtblNDZWdqIiwiY2xpZW50X2lkIjoiZDljZTdjYWUtNzJkZi00NjZmLTg0NjItMTdiM2FmNTdjZjgxIn0.m8piEp-N-EuVHsy4fgUi89ZEBTHck2BXOD9pWN6dfyASTbTmz4APzgvDM_b-j0aAdWyzhIWsanOerr1KYe8kHSc0jaGRmiZ8mdjhFZMkrpQ_tlqsL-jZekLC4HpUrO9PG_6bs2TNjBiQrVGG8eNlkuJBNV4jS9lf6uzb1ysn_Ukgqp-WUvjr7_v_hloUH3ARBkM2QGBOIJ0F6GhTXi9ucSYXrZYpO-fnS7TnCz4oWuRPnAhKXhsm51Ln-6-14ZWGtSZOq9px8_v0k0B3mAJLAT8Ve06pu51gMGy8dj3FdqEhnTPuNM4ov2iv-C1SQ6bfjvGThP1ZgAVd_xlRO0_inQ'
        }).then(function () {
            state = 1
            alert('초기화 완료');
        }).catch(function (error) {
            alert('초기화 실패\n' + JSON.stringify(error));
        });
    }

    /*
     * 이니허브 통합인증창 호출
     */
    function auth() {

        if (state < 1) {
            alert('초기화를 먼저 실행해 주세요.');
            return;
        }

        let getStatus = function (param) {
            return new Promise((resolve, reject) => {
                IHUB_C.runAuthFunc(param).then(function (result) {
                    if (result.resCode === 1200 && result.status === "IN_PROGRESS") {
                        getStatus(param).then(resolve).catch(reject);
                        return;
                    }
                    resolve(result);
                }).catch(reject)
            })
        }

        IHUB_C.login({
            authParam: {}
        }).then(function (result) {
            if (result.nextStep) {
                return getStatus({
                    funcName: result.nextStep.funcName,
                    authParam: result.nextStep.authParam
                });
            }
            return result;

        }).then(function (result) {

            console.log('authToken:' + result.authToken);

            // 인증토큰 검증을 요청한다.
            $('#authToken').val(result.authToken);
            $("#form").submit();

        }).catch(function (error) {
            alert('인증 실패\n' + JSON.stringify(error));
        });
    }

</script>
</body>
</html>